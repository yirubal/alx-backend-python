#!/usr/bin/env bash

echo "ðŸš€ Applying updated deployment (Rolling Update)..."
kubectl apply -f blue_deployment.yaml

echo "â³ Monitoring rollout status..."
kubectl rollout status deployment/django-messaging-blue

echo "ðŸŒ Testing application availability during update..."
SERVICE_URL=$(minikube service django-messaging-service --url)

for i in {1..10}
do
  curl -s $SERVICE_URL > /dev/null && echo "Request $i: OK"
  sleep 1
done

echo "ðŸ“¦ Verifying running pods..."
kubectl get pods -l app=django-messaging

echo "âœ… Rolling update completed successfully"
