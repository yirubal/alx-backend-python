#!/usr/bin/env bash

echo "ğŸ“ˆ Scaling Django app to 3 replicas..."
kubectl scale deployment django-messaging --replicas=3

echo "â³ Waiting for pods to be ready..."
sleep 10

echo "ğŸ“¦ Listing running pods..."
kubectl get pods

echo "ğŸŒ Getting service URL..."
SERVICE_URL=$(minikube service django-messaging-service --url)
echo "Service URL: $SERVICE_URL"

echo "ğŸš€ Running load test using wrk (10 seconds)..."
wrk -t2 -c20 -d10s $SERVICE_URL

echo "ğŸ“Š Monitoring resource usage..."
kubectl top pods
